<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EPæ–‡å­—èµ„æºå‘å¸ƒä¸­å¿ƒ - å…¼å®¹æ¨¡å¼</title>
    <style>
        body {
            font-family: 'å®‹ä½“', SimSun, Arial, sans-serif;
            font-size: 14px;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border: 1px solid #ddd;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #4CAF50;
        }
        .header h1 {
            color: #2c3e50;
            font-size: 28px;
            margin: 0 0 10px 0;
        }
        .header p {
            color: #666;
            font-size: 16px;
            margin: 0;
        }
        .status-bar {
            background-color: #e8f5e8;
            border: 1px solid #4CAF50;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 5px;
            text-align: center;
            font-size: 12px;
            color: #2e7d32;
        }
        
        /* æœç´¢å’Œç­›é€‰åŒºåŸŸ */
        .search-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid #e9ecef;
        }
        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .search-input {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .search-btn {
            padding: 10px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .filter-section {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        .filter-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .filter-select {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 12px;
        }
        
        /* ç»“æœåŒºåŸŸ */
        .results-section {
            margin-top: 20px;
        }
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        .results-count {
            font-size: 14px;
            color: #4CAF50;
            font-weight: bold;
        }
        
        /* å‘å¸ƒå¡ç‰‡ */
        .release-grid {
            display: block;
        }
        .release-card {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        .release-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        .release-title {
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .release-info {
            margin-bottom: 15px;
        }
        .release-info p {
            margin: 5px 0;
            font-size: 13px;
            color: #666;
        }
        .release-info .label {
            font-weight: bold;
            color: #333;
            display: inline-block;
            width: 80px;
        }
        .format-tags {
            margin: 10px 0;
        }
        .format-tag {
            background: #4CAF50;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            margin-right: 5px;
            display: inline-block;
        }
        .license-section {
            background: rgba(76, 175, 80, 0.1);
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-size: 12px;
        }
        .license-section h4 {
            margin: 0 0 5px 0;
            color: #2e7d32;
            font-size: 13px;
        }
        .download-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        .download-section h4 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 14px;
        }
        .download-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .download-btn {
            display: inline-block;
            padding: 8px 15px;
            background: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-size: 12px;
            transition: background-color 0.3s;
        }
        .download-btn:hover {
            background: #45a049;
        }
        .download-btn.secondary {
            background: transparent;
            border: 1px solid #4CAF50;
            color: #4CAF50;
        }
        .download-btn.secondary:hover {
            background: #4CAF50;
            color: white;
        }
        .preview-section {
            margin-top: 10px;
            text-align: center;
        }
        .preview-btn {
            display: inline-block;
            padding: 8px 15px;
            background: transparent;
            border: 1px solid #2196F3;
            color: #2196F3;
            text-decoration: none;
            border-radius: 4px;
            font-size: 12px;
            transition: all 0.3s;
        }
        .preview-btn:hover {
            background: #2196F3;
            color: white;
        }
        
        /* ç»Ÿè®¡åŒºåŸŸ */
        .stats-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
            text-align: center;
        }
        .stats-section h2 {
            margin: 0 0 20px 0;
            color: #2c3e50;
            font-size: 20px;
        }
        .stats-grid {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
        }
        .stat-item {
            text-align: center;
            min-width: 120px;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
            display: block;
        }
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        /* æ— ç»“æœæç¤º */
        .no-results {
            text-align: center;
            padding: 40px;
            background: #f8f9fa;
            border-radius: 8px;
            color: #666;
        }
        .no-results h3 {
            color: #4CAF50;
            margin-bottom: 10px;
        }
        
        /* åŠ è½½çŠ¶æ€ */
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        .loading-text {
            margin-top: 10px;
            font-size: 14px;
        }
        
        /* é”™è¯¯çŠ¶æ€ */
        .error {
            text-align: center;
            padding: 20px;
            color: #d32f2f;
            background: #ffebee;
            border: 1px solid #f44336;
            border-radius: 5px;
        }
        
        /* å“åº”å¼è®¾è®¡å…¼å®¹ */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            .search-box {
                flex-direction: column;
            }
            .filter-section {
                flex-direction: column;
                align-items: stretch;
            }
            .download-buttons {
                flex-direction: column;
            }
            .stats-grid {
                flex-direction: column;
            }
        }
        
        /* IE6-8 å…¼å®¹æ€§æ ·å¼ */
        .ie-fix {
            zoom: 1;
        }
        .clearfix {
            clear: both;
        }
        
        /* æ‰“å°æ ·å¼ */
        @media print {
            body {
                background: white;
            }
            .container {
                box-shadow: none;
                border: none;
            }
            .search-section, .controls {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1> EPæ–‡å­—èµ„æºå‘å¸ƒä¸­å¿ƒ</h1>
        </div>

        <div class="status-bar">
            âœ… ç³»ç»Ÿå·²åŠ è½½ <span id="totalCount">0</span> ä¸ªèµ„æº
        </div>

        <!-- æœç´¢å’Œç­›é€‰åŒºåŸŸ -->
        <div class="search-section">
            <div class="search-box">
                <input type="text" class="search-input" id="searchInput" placeholder="è¾“å…¥å…³é”®è¯æœç´¢å‘å¸ƒå†…å®¹...">
                <button class="search-btn" onclick="searchReleases()">ğŸ” æœç´¢</button>
            </div>
            
            <div class="filter-section">
                <div class="filter-group">
                    <label>æ ¼å¼:</label>
                    <select class="filter-select" id="formatFilter" onchange="filterReleases()">
                        <option value="">å…¨éƒ¨æ ¼å¼</option>
                        <option value="PDF">PDF</option>
                        <option value="Word">Word</option>
                        <option value="html">HTML</option>
                        <option value="Pub">Pub</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>è®¸å¯è¯:</label>
                    <select class="filter-select" id="licenseFilter" onchange="filterReleases()">
                        <option value="">å…¨éƒ¨è®¸å¯è¯</option>
                        <option value="CC BY-NC-SA 4.0">CC BY-NC-SA 4.0</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>æ’åº:</label>
                    <select class="filter-select" id="sortBy" onchange="sortReleases()">
                        <option value="name">æŒ‰åç§°</option>
                        <option value="date">æŒ‰æ—¥æœŸ</option>
                        <option value="id">æŒ‰ID</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- ç»“æœåŒºåŸŸ -->
        <div class="results-section">
            <div class="results-header">
                <div class="results-count">
                    æ‰¾åˆ° <span id="resultNumber">0</span> ä¸ªç»“æœ
                </div>
            </div>

            <div id="releaseGrid">
                <!-- å‘å¸ƒå†…å®¹å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
            </div>

            <div id="noResults" class="no-results" style="display: none;">
                <h3>æœªæ‰¾åˆ°åŒ¹é…çš„ç»“æœ</h3>
                <p>è¯·å°è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–è¿‡æ»¤é€‰é¡¹</p>
            </div>
        </div>

        <!-- ç»Ÿè®¡åŒºåŸŸ -->
        <div class="stats-section">
            <h2><i>ğŸ“Š</i> å‘å¸ƒç»Ÿè®¡</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-number" id="totalReleases">0</span>
                    <div class="stat-label">æ€»å‘å¸ƒæ•°</div>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="totalFormats">0</span>
                    <div class="stat-label">æ”¯æŒæ ¼å¼</div>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="totalDownloads">0</span>
                    <div class="stat-label">ä¸‹è½½æ¬¡æ•°</div>
                </div>
            </div>
        </div>
    </div>


    <script>
        // EPæ–‡å­—èµ„æºå‘å¸ƒç³»ç»Ÿ - å…¼å®¹æ¨¡å¼
        var releases = [];
        var filteredReleases = [];
        var downloadStats = {};
        
        // æ ¼å¼åˆ°æ–‡ä»¶åçš„æ˜ å°„ï¼ˆå…¼å®¹IE6-8çš„å†™æ³•ï¼‰
        var formatFileMap = {
            'PDF': 'PDF.pdf',
            'Word': 'Word.docx',
            'Pub': 'Pub.pub',
            'html': 'html.html'
        };

        // ä»JSONæ–‡ä»¶åŠ è½½æ•°æ®ï¼ˆå…¼å®¹IE6-8ï¼‰
        function loadReleases() {
            try {
                // åˆ›å»ºXMLHttpRequestå¯¹è±¡ï¼ˆå…¼å®¹IE6-8ï¼‰
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4) {
                        if (xhr.status === 200) {
                            try {
                                var data = eval('(' + xhr.responseText + ')'); // å…¼å®¹IE6-8çš„JSONè§£æ
                                releases = data;
                                filteredReleases = releases.slice(); // å¤åˆ¶æ•°ç»„
                                renderReleases();
                                updateStats();
                            } catch (e) {
                                showError('æ•°æ®æ ¼å¼é”™è¯¯ï¼š' + e.message);
                            }
                        } else {
                            showError('æ— æ³•åŠ è½½æ•°æ®ï¼ŒçŠ¶æ€ç ï¼š' + xhr.status);
                        }
                    }
                };
                
                // å°è¯•åŠ è½½ä¸åŒè·¯å¾„çš„JSONæ–‡ä»¶
                var paths = [
                    '../EP/json/all.json',
                    'json/all.json',
                    '/EP/json/all.json'
                ];
                
                var currentPath = 0;
                function tryNextPath() {
                    if (currentPath < paths.length) {
                        xhr.open('GET', paths[currentPath], true);
                        xhr.onerror = function() {
                            currentPath++;
                            tryNextPath();
                        };
                        xhr.send();
                    } else {
                        // å¦‚æœæ‰€æœ‰è·¯å¾„éƒ½å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                        useMockData();
                    }
                }
                
                tryNextPath();
                
            } catch (e) {
                // å¦‚æœXMLHttpRequestå¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                useMockData();
            }
        }

        // ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼ˆå½“JSONåŠ è½½å¤±è´¥æ—¶ï¼‰
        function useMockData() {
            releases = [
                {
                    name: "é€Ÿé€šç³»åˆ— ç§’å­¦Python (æ–°æ‰‹å…¥é—¨)2026",
                    publish_id: "43251224001",
                    formats: ["Word", "PDF"],
                    license: "CC BY-NC-SA 4.0",
                    register_date: "2025-12-24",
                    final_date: "2026-1-11"
                },
                {
                    name: "é€Ÿé€šç³»åˆ— ç§’å­¦C++ å…¥é—¨ (æœªå®Œæˆ)",
                    publish_id: "43260118001",
                    formats: ["Pub", "PDF"],
                    license: "CC BY-NC-SA 4.0",
                    register_date: "2025-01-18",
                    final_date: "N/A"
                },
                {
                    name: "å°è¯´ã€Šé€†å…‰ã€‹ ä¸­ç¯‡ ç§‘å¹»å°è¯´",
                    publish_id: "40250616001",
                    formats: ["html"],
                    license: "CC BY-NC-SA 4.0",
                    register_date: "2026-1-23",
                    final_date: "2025-6-16"
                },
                {
                    name: "å°è¯´ã€Šé˜¿å°”æ³•æˆ˜åŒºï¼šé›¶ã€‹ çŸ­ç¯‡",
                    publish_id: "40251201001",
                    formats: ["Word"],
                    license: "CC BY-NC-SA 4.0",
                    register_date: "2026-1-23",
                    final_date: "2025-12-01"
                },
                {
                    name: "ã€Šå‡è¡¡è€…ï¼šæ—¶èŒ§è¤¶å…‰ã€‹å®Œæ•´ç‰ˆ",
                    publish_id: "40250616002",
                    formats: ["html", "PDF"],
                    license: "CC BY-NC-SA 4.0",
                    register_date: "2026-1-23",
                    final_date: "2026-1-23"
                }
            ];
            filteredReleases = releases.slice();
            renderReleases();
            updateStats();
        }

        // æ¸²æŸ“å‘å¸ƒå†…å®¹
        function renderReleases() {
            var container = document.getElementById('releaseGrid');
            var resultsCount = document.getElementById('resultNumber');
            var noResults = document.getElementById('noResults');
            
            resultsCount.textContent = filteredReleases.length;
            
            if (filteredReleases.length === 0) {
                container.innerHTML = '';
                noResults.style.display = 'block';
                return;
            }
            
            noResults.style.display = 'none';
            
            var html = '';
            for (var i = 0; i < filteredReleases.length; i++) {
                var release = filteredReleases[i];
                html += createReleaseCard(release);
            }
            
            container.innerHTML = html;
        }

        // åˆ›å»ºå‘å¸ƒå¡ç‰‡
        function createReleaseCard(release) {
            var formatsHtml = '';
            for (var i = 0; i < release.formats.length; i++) {
                formatsHtml += '<span class="format-tag"><i>ğŸ“„</i> ' + release.formats[i] + '</span>';
            }
            
            var downloadsHtml = '';
            for (var i = 0; i < release.formats.length; i++) {
                var format = release.formats[i];
                var filename = formatFileMap[format] || format;
                downloadsHtml += '<a href="../EP/assets/' + release.publish_id + '/' + filename + '" class="download-btn" download="" onclick="trackDownload(\'' + release.publish_id + '\')">' +
                                '<i>â¬‡</i> ä¸‹è½½' + format + 'ç‰ˆæœ¬</a>';
            }
            
            var finalDateHtml = release.final_date && release.final_date !== 'N/A' ? 
                '<p><span class="label">å®Œæˆæ—¥æœŸ:</span> ' + release.final_date + '</p>' : '';
            
            return '<div class="release-card">' +
                   '<div class="release-title"><i>ğŸ“–</i> ' + release.name + '</div>' +
                   '<div class="release-info">' +
                   '<p><span class="label">å‘å¸ƒID:</span> ' + release.publish_id + '</p>' +
                   '<p><span class="label">æ³¨å†Œæ—¥æœŸ:</span> ' + release.register_date + '</p>' +
                   finalDateHtml +
                   '</div>' +
                   '<div class="format-tags">' + formatsHtml + '</div>' +
                   '<div class="license-section">' +
                   '<h4><i>âš–</i> è®¸å¯è¯ä¿¡æ¯</h4>' +
                   '<p>æœ¬ä½œå“é‡‡ç”¨ ' + release.license + ' è®¸å¯åè®®ã€‚</p>' +
                   '</div>' +
                   '<div class="download-section">' +
                   '<h4><i>â¬‡</i> ä¸‹è½½é€‰é¡¹</h4>' +
                   '<div class="download-buttons">' + downloadsHtml +
                   '<a href="../EP/assets/' + release.publish_id + '/LICENSE" class="download-btn secondary" target="_blank">' +
                   '<i>ğŸ“‹</i> æŸ¥çœ‹è®¸å¯è¯</a>' +
                   '</div>' +
                   '</div>' +
                   // åªæœ‰HTMLæ ¼å¼æ‰æ˜¾ç¤ºåœ¨çº¿é¢„è§ˆï¼Œç‚¹å‡»åè·³è½¬åˆ°å®é™…HTMLé¡µé¢
                   (release.formats.indexOf('html') !== -1 ?
                   '<div class="preview-section">' +
                   '<a href="../EP/assets/' + release.publish_id + '/html.html" class="preview-btn" target="_blank">' +
                   '<i>ğŸ‘</i> åœ¨çº¿é¢„è§ˆ</a>' +
                   '</div>' : '') +
                   '</div>';
        }

        // æœç´¢åŠŸèƒ½
        function searchReleases() {
            var searchTerm = document.getElementById('searchInput').value.toLowerCase();
            filterReleases();
        }

        // ç­›é€‰åŠŸèƒ½
        function filterReleases() {
            var searchTerm = document.getElementById('searchInput').value.toLowerCase();
            var formatFilter = document.getElementById('formatFilter').value;
            var licenseFilter = document.getElementById('licenseFilter').value;
            
            filteredReleases = [];
            
            for (var i = 0; i < releases.length; i++) {
                var release = releases[i];
                var matchesSearch = !searchTerm || release.name.toLowerCase().indexOf(searchTerm) !== -1;
                var matchesFormat = !formatFilter || release.formats.indexOf(formatFilter) !== -1;
                var matchesLicense = !licenseFilter || release.license === licenseFilter;
                
                if (matchesSearch && matchesFormat && matchesLicense) {
                    filteredReleases.push(release);
                }
            }
            
            renderReleases();
        }

        // æ’åºåŠŸèƒ½
        function sortReleases() {
            var sortBy = document.getElementById('sortBy').value;
            
            filteredReleases.sort(function(a, b) {
                var aValue, bValue;
                
                switch (sortBy) {
                    case 'name':
                        aValue = a.name.toLowerCase();
                        bValue = b.name.toLowerCase();
                        break;
                    case 'date':
                        aValue = new Date(a.register_date);
                        bValue = new Date(b.register_date);
                        break;
                    case 'id':
                        aValue = a.publish_id;
                        bValue = b.publish_id;
                        break;
                    default:
                        return 0;
                }
                
                if (aValue < bValue) return -1;
                if (aValue > bValue) return 1;
                return 0;
            });
            
            renderReleases();
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            var totalReleases = releases.length;
            var totalFormats = 0;
            var formatSet = {};
            
            for (var i = 0; i < releases.length; i++) {
                for (var j = 0; j < releases[i].formats.length; j++) {
                    formatSet[releases[i].formats[j]] = true;
                }
            }
            
            for (var format in formatSet) {
                totalFormats++;
            }
            
            document.getElementById('totalReleases').textContent = totalReleases;
            document.getElementById('totalFormats').textContent = totalFormats;
            document.getElementById('totalDownloads').textContent = getTotalDownloads();
            document.getElementById('totalCount').textContent = totalReleases;
        }

        // è·å–æ€»ä¸‹è½½æ¬¡æ•°
        function getTotalDownloads() {
            var total = 0;
            for (var id in downloadStats) {
                total += downloadStats[id];
            }
            return total;
        }

        // è·Ÿè¸ªä¸‹è½½
        function trackDownload(releaseId) {
            if (!downloadStats[releaseId]) {
                downloadStats[releaseId] = 0;
            }
            downloadStats[releaseId]++;
            
            // ä¿å­˜åˆ°localStorageï¼ˆå¦‚æœæ”¯æŒï¼‰
            try {
                localStorage.setItem('ep-download-stats', JSON.stringify(downloadStats));
            } catch (e) {
                // å¿½ç•¥ä¸æ”¯æŒçš„æƒ…å†µ
            }
            
            updateStats();
        }


        // æ˜¾ç¤ºé”™è¯¯
        function showError(message) {
            document.getElementById('releaseGrid').innerHTML = 
                '<div class="error">' +
                '<h3>âŒ åŠ è½½å¤±è´¥</h3>' +
                '<p>' + message + '</p>' +
                '<button class="btn" onclick="loadReleases()">é‡æ–°åŠ è½½</button>' +
                '</div>';
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.onload = function() {
            // ä¸ºIE6-8æ·»åŠ å…¼å®¹æ€§å¤„ç†
            if (navigator.userAgent.indexOf('MSIE 6') !== -1 || 
                navigator.userAgent.indexOf('MSIE 7') !== -1 || 
                navigator.userAgent.indexOf('MSIE 8') !== -1) {
                document.body.className += ' ie-fix';
            }
            
            // åŠ è½½ä¸‹è½½ç»Ÿè®¡ï¼ˆå¦‚æœæ”¯æŒlocalStorageï¼‰
            try {
                var savedStats = localStorage.getItem('ep-download-stats');
                if (savedStats) {
                    downloadStats = eval('(' + savedStats + ')');
                }
            } catch (e) {
                // å¿½ç•¥é”™è¯¯
            }
            
            // åŠ è½½æ•°æ®
            loadReleases();
            
            // ç»‘å®šå›è½¦é”®æœç´¢
            document.getElementById('searchInput').onkeypress = function(e) {
                if (!e) e = window.event;
                if (e.keyCode === 13) {
                    searchReleases();
                }
            };
        };

    </script>
</body>
</html>