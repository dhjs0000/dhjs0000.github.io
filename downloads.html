<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>软件下载 - Ethernos Studio</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="cookie-consent.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <div id="nav-placeholder"></div>

    <main class="content">
        <h1 class="page-title">软件下载</h1>

        <div class="asymmetric-layout">
            <!-- 左侧主要内容 -->
            <div class="main-content">
                <!-- BCC 下载部分 -->
                <div class="info-panel card-highlight" id="bcc-card">
                    <div class="info-panel-header">
                        <i class="fas fa-code"></i>
                        <h2>BCC编程语言</h2>
                    </div>
                    <p>简单、优雅的现代编程语言，为开发者提供更好的编程体验。</p>
                    
                    <div class="version-info" style="display: flex; gap: 24px; margin: 16px 0; padding: 16px; background: var(--bg-color); border-radius: 6px;">
                        <div>
                            <i class="fas fa-code-branch" style="color: var(--primary-color);"></i>
                            <span id="bcc-version" style="margin-left: 8px; font-family: monospace;">加载中...</span>
                        </div>
                        <div>
                            <i class="far fa-calendar-alt" style="color: var(--text-muted);"></i>
                            <span id="bcc-date" style="margin-left: 8px; color: var(--text-muted);">加载中...</span>
                        </div>
                    </div>

                    <ul style="list-style: none; padding: 0; margin: 16px 0;">
                        <li style="padding: 8px 0; border-bottom: 1px solid var(--border-color);"><i class="fas fa-check" style="color: var(--secondary-color); margin-right: 8px;"></i>简单易用的语法</li>
                        <li style="padding: 8px 0; border-bottom: 1px solid var(--border-color);"><i class="fas fa-check" style="color: var(--secondary-color); margin-right: 8px;"></i>强大的编程功能</li>
                        <li style="padding: 8px 0;"><i class="fas fa-check" style="color: var(--secondary-color); margin-right: 8px;"></i>完整的开发工具链</li>
                    </ul>

                    <div class="release-notes" id="bcc-notes" style="margin: 16px 0; padding: 16px; background: var(--bg-color); border-radius: 6px;">
                        <h3 style="margin: 0 0 12px 0; font-size: 0.875rem; color: var(--text-muted);">更新说明</h3>
                        <p style="margin: 0; color: var(--text-muted);">加载中...</p>
                    </div>

                    <div class="button-group" style="justify-content: flex-start;">
                        <a href="#" id="bcc-download" class="button" target="_blank">
                            <i class="fas fa-download"></i> 下载
                        </a>
                        <a href="docs.html#bcc" class="button outline">
                            <i class="fas fa-book"></i> 文档
                        </a>
                    </div>
                </div>

                <!-- Blender-VMT 下载部分 -->
                <div class="info-panel card-success" id="vmt-card" style="margin-top: 24px;">
                    <div class="info-panel-header">
                        <i class="fab fa-blender" style="color: var(--secondary-color);"></i>
                        <h2>Blender-VMT-Remastered</h2>
                    </div>
                    <p>专业的 Blender 版本管理工具，让项目版本控制更轻松。</p>
                    
                    <div class="version-info" style="display: flex; gap: 24px; margin: 16px 0; padding: 16px; background: var(--bg-color); border-radius: 6px;">
                        <div>
                            <i class="fas fa-code-branch" style="color: var(--primary-color);"></i>
                            <span id="vmt-version" style="margin-left: 8px; font-family: monospace;">加载中...</span>
                        </div>
                        <div>
                            <i class="far fa-calendar-alt" style="color: var(--text-muted);"></i>
                            <span id="vmt-date" style="margin-left: 8px; color: var(--text-muted);">加载中...</span>
                        </div>
                    </div>

                    <ul style="list-style: none; padding: 0; margin: 16px 0;">
                        <li style="padding: 8px 0; border-bottom: 1px solid var(--border-color);"><i class="fas fa-check" style="color: var(--secondary-color); margin-right: 8px;"></i>高效的版本管理</li>
                        <li style="padding: 8px 0; border-bottom: 1px solid var(--border-color);"><i class="fas fa-check" style="color: var(--secondary-color); margin-right: 8px;"></i>直观的用户界面</li>
                        <li style="padding: 8px 0;"><i class="fas fa-check" style="color: var(--secondary-color); margin-right: 8px;"></i>完整的项目追踪</li>
                    </ul>

                    <div class="release-notes" id="vmt-notes" style="margin: 16px 0; padding: 16px; background: var(--bg-color); border-radius: 6px;">
                        <h3 style="margin: 0 0 12px 0; font-size: 0.875rem; color: var(--text-muted);">更新说明</h3>
                        <p style="margin: 0; color: var(--text-muted);">加载中...</p>
                    </div>

                    <div class="button-group" style="justify-content: flex-start;">
                        <a href="#" id="vmt-download" class="button" target="_blank">
                            <i class="fas fa-download"></i> 下载
                        </a>
                        <a href="docs.html#blender-vmt" class="button outline">
                            <i class="fas fa-book"></i> 文档
                        </a>
                    </div>
                </div>
            </div>

            <!-- 右侧侧边栏 -->
            <aside class="sidebar">
                <div class="sidebar-section">
                    <h3>快速链接</h3>
                    <ul class="list-group">
                        <li class="list-group-item"><a href="https://github.com/dhjs0000/bccWeb"><i class="fab fa-github"></i> BCC GitHub</a></li>
                        <li class="list-group-item"><a href="https://github.com/dhjs0000/Blender-VMT-Remastered"><i class="fab fa-github"></i> VMT GitHub</a></li>
                        <li class="list-group-item"><a href="docs.html"><i class="fas fa-book"></i> 文档中心</a></li>
                    </ul>
                </div>

                <div class="sidebar-section">
                    <h3>版本历史</h3>
                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-date">2025-01</div>
                            <div class="timeline-content">BCC v1.0 发布</div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-date">2024-12</div>
                            <div class="timeline-content">VMT-Remastered v2.0</div>
                        </div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3>标签</h3>
                    <div>
                        <span class="tag">编程语言</span>
                        <span class="tag">Blender</span>
                        <span class="tag">开源</span>
                        <span class="tag">工具</span>
                    </div>
                </div>
            </aside>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-container">
            <div class="footer-links">
                <div class="footer-section">
                    <h3>项目</h3>
                    <a href="https://ethernos.cn/bccWeb/">BCC语言</a>
                </div>
                <div class="footer-section">
                    <h3>资源</h3>
                    <a href="downloads.html">软件下载</a>
                    <a href="tools.html">开发工具</a>
                </div>
                <div class="footer-section">
                    <h3>服务</h3>
                    <a href="blog.html">技术博客</a>
                    <a href="questions.html">技术支持</a>
                </div>
                <div class="footer-section">
                    <h3>关于</h3>
                    <a href="team.html">团队</a>
                    <a href="contact.html">联系我们</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>Copyright (C) 2026 Ethernos</p>
                <p>本程序为自由软件，在自由软件联盟发布的GNU通用公共许可协议的约束下，你可以对其进行再发布及修改。协议版本为第三版或（随你）更新的版本。</p>
                <p>我们希望发布的这个网站有用，但不保证，甚至不保证它有经济价值和适合特定用途。详情参见GNU通用公共许可协议。</p>

                <p>This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.</p>
                <p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</p>
                <p>You should have received a copy of the GNU General Public License along with this program. If not, see <a href="https://www.gnu.org/licenses/">https://www.gnu.org/licenses/</a>.</p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script src="config.js"></script>
    <script>
        // GitHub API 配置
        const repos = {
            bcc: {
                owner: 'dhjs0000',
                repo: 'bccWeb',
                fallback: {
                    version: '获取失败，请前往Github查看',
                    date: '获取失败，请前往Github查看',
                    notes: '获取失败，请前往Github查看'
                }
            },
            vmt: {
                owner: 'dhjs0000',
                repo: 'Blender-VMT-Remastered',
                fallback: {
                    version: '获取失败，请前往Github查看',
                    date: '获取失败，请前往Github查看',
                    notes: '获取失败，请前往Github查看'
                }
            }
        };

        // 格式化日期
        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('zh-CN', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            } catch (error) {
                return dateString;
            }
        }

        // 使用备用数据
        function useFallbackData(cardId, fallbackData) {
            document.getElementById(`${cardId}-version`).textContent = fallbackData.version;
            document.getElementById(`${cardId}-date`).textContent = fallbackData.date;
            document.getElementById(`${cardId}-notes`).innerHTML = `
                <h3 style="margin: 0 0 12px 0; font-size: 0.875rem; color: var(--text-muted);">更新说明</h3>
                <p style="margin: 0; color: var(--text-muted);">${fallbackData.notes}</p>
            `;
            const downloadBtn = document.getElementById(`${cardId}-download`);
            downloadBtn.href = `https://github.com/${repos[cardId].owner}/${repos[cardId].repo}/releases`;
            downloadBtn.innerHTML = `<i class="fas fa-download"></i> 在 GitHub 下载`;
        }

        // 获取最新版本信息
        async function getLatestRelease(owner, repo, cardId) {
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000);

                const headers = {
                    'Accept': 'application/vnd.github.v3+json'
                };

                if (typeof config !== 'undefined' && config.githubToken) {
                    headers.Authorization = `token ${config.githubToken}`;
                }

                const response = await fetch(
                    `https://api.github.com/repos/${owner}/${repo}/releases/latest`,
                    { headers, signal: controller.signal }
                );

                clearTimeout(timeoutId);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                document.getElementById(`${cardId}-version`).textContent = data.tag_name || '暂无版本信息';
                document.getElementById(`${cardId}-date`).textContent = formatDate(data.published_at) || '暂无发布日期';

                const notes = data.body ? marked.parse(data.body) : '暂无更新说明';
                document.getElementById(`${cardId}-notes`).innerHTML = `
                    <h3 style="margin: 0 0 12px 0; font-size: 0.875rem; color: var(--text-muted);">更新说明</h3>
                    <div class="markdown-body" style="color: var(--text-muted);">${notes}</div>
                `;

                const downloadBtn = document.getElementById(`${cardId}-download`);
                if (data.assets && data.assets.length > 0) {
                    downloadBtn.href = data.assets[0].browser_download_url;
                    downloadBtn.innerHTML = `<i class="fas fa-download"></i> 下载 ${data.tag_name}`;
                } else {
                    downloadBtn.href = data.html_url;
                    downloadBtn.innerHTML = `<i class="fas fa-download"></i> 在 GitHub 下载`;
                }
            } catch (error) {
                console.error('Error:', error);
                useFallbackData(cardId, repos[cardId].fallback);
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            ['bcc', 'vmt'].forEach(cardId => {
                const repo = repos[cardId];
                getLatestRelease(repo.owner, repo.repo, cardId);
            });
        });
    </script>
    <script src="cookie-consent.js"></script>
</body>
</html>
